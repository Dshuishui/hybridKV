<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serverless Dashboard</title>
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-plus/2.3.14/index.css">
    <!-- Vue 3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.js"></script>
    <!-- Element Plus JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/element-plus/2.3.14/index.full.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Element Plus 图标 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/element-plus/2.3.14/icons.min.js"></script>
    
    <style>
        /* 从 common.less 导入的公共样式 */
        :root {
          --emdc-color-primary: #0C8357;
          --emdc-hover-color-primary: #0BB677;
          --emdc-color-primary-1: #F6FCF9;

          --emdc-bg-color-container: #fff;
          --emdc-bg-color-fill: #F5F7FA;
          --emdc-hover-border-color: #DCDFE6;

          --emdc-text-color-primary: #333;
          --emdc-text-color-regular: #666;
          --emdc-text-color-secondary: #999;

          --emdc-color-success: var(--emdc-color-primary);
          --emdc-color-warning: #F7B500;
          --emdc-color-warning-light: #FEFBF2;
          --emdc-color-danger: #e02020;
          --emdc-color-danger-light:#FDF4F4;

          --box-shadow-color: #dcdfe6;
          --scrollbar-color: rgba(144, 147, 153, 0.5);
        }

        .common-font {
          text-align: left;
          color: var(--emdc-text-color-primary);
          font-family: "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
          font-size: 14px;
          font-style: normal;
        }

        .-emdc-font-size-base {
          font-family: "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
          font-size: 14px;
          color: var(--emdc-text-color-primary);
        }

        .-emdc-button-primary {
          background: linear-gradient( 90deg, #4EC58C 0%, #497AAE 100%) !important;
          border-radius: 4px;
          border: none !important;
          color: #fff !important;
        }

        .-emdc-button-primary:hover {
          background: linear-gradient( 90deg, #3DA171 0%, #345F8D 100%) !important;
        }

        .-emdc-button-plain {
          background: transparent;
          border-radius: 4px;
          font-size: 14px;
          font-weight: 400;
        }

        .-emdc-button-plain:hover {
          color: var(--emdc-color-primary) !important;
          border: 1px solid var(--emdc-color-primary) !important;
          background: #e6f2ee !important;
        }

        .common-input .el-input__wrapper {
          background: transparent !important;
          box-shadow: 0 0 0 1px var(--box-shadow-color) inset;
        }

        .common-input .el-input__wrapper:focus {
          box-shadow: 0 0 0 1px var(--emdc-color-primary) inset !important;
        }

        .common-input .el-input__wrapper:hover {
          box-shadow: 0 0 0 1px var(--emdc-color-primary) inset !important;
        }

        .common-select .el-select__wrapper {
          background: transparent !important;
          box-shadow: 0 0 0 1px var(--box-shadow-color) inset;
        }

        .common-select .el-select__wrapper:focus {
          box-shadow: 0 0 0 1px var(--emdc-color-primary) inset !important;
        }

        .common-select .el-select__wrapper:hover {
          box-shadow: 0 0 0 1px var(--emdc-color-primary) inset !important;
        }

        .common-textarea .el-textarea__inner {
          color: var(--emdc-text-color-primary) !important;
          background: transparent;
          box-shadow: 0 0 0 1px var(--box-shadow-color) inset !important;
        }

        .common-textarea .el-textarea__inner:hover,
        .common-textarea .el-textarea__inner:focus {
          box-shadow: 0 0 0 1px var(--emdc-color-primary) inset !important;
        }

        .common-table .el-table__header-wrapper .el-table__cell {
          background: #f5f7fa;
        }

        .common-table .el-table__body-wrapper .el-table__cell {
          background: #fff;
        }

        .common-table .el-table__row:hover td {
          background-color: #f5f7fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100%;
            -moz-osx-font-smoothing: grayscale;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE 10+ */
            font-family: Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        ::-webkit-scrollbar {
            display: none; /* Chrome Safari */
        }

        #app {
            .sidebar-container {
                transition: width 0.28s;
                width: 208px !important;
                background-color: var(--emdc-bg-color-container);
                height: 100%;
                font-size: 0px;
                z-index: 1001;
                overflow: hidden;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .main-tabs {
            margin-bottom: 30px;
        }

        .content-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .namespace-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid var(--emdc-color-primary);
        }

        .namespace-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, var(--emdc-color-primary) 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: 400px;
        }

        .benchmark-controls {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .benchmark-results {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .function-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .test-chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: 450px;
        }

        .test-chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--emdc-text-color-primary);
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        @media (max-width: 768px) {
            .benchmark-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- 头部 -->
            <div class="header">
                <h1>🚀 无服务器仪表盘</h1>
                <p class="subtitle">OpenFaaS 管理平台</p>
            </div>

            <!-- 主要Tab导航 -->
            <el-tabs v-model="activeTab" class="main-tabs" type="card">
                <el-tab-pane label="命名空间" name="namespace">
                    <div class="content-panel">
                        <div class="section-header">
                            <h2 class="section-title">命名空间管理</h2>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <el-form-item label="当前命名空间:">
                                <el-select v-model="selectedNamespace" class="common-select" placeholder="选择命名空间">
                                    <el-option label="default" value="default"></el-option>
                                    <el-option label="production" value="production"></el-option>
                                    <el-option label="development" value="development"></el-option>
                                    <el-option label="staging" value="staging"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>

                        <div class="card-grid">
                            <div v-for="ns in namespaces" :key="ns.name" class="namespace-card">
                                <div class="card-header">
                                    <h3 class="card-title">{{ ns.name }}</h3>
                                    <el-tag :type="getStatusType(ns.status)">{{ ns.statusText }}</el-tag>
                                </div>
                                <p><strong>函数数量:</strong> {{ ns.functions }}</p>
                                <p><strong>CPU 使用率:</strong> {{ ns.cpuUsage }}</p>
                                <p><strong>内存使用:</strong> {{ ns.memory }}</p>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>

                <el-tab-pane label="函数管理" name="functions">
                    <div class="content-panel">
                        <div class="section-header">
                            <h2 class="section-title">函数管理</h2>
                            <el-button class="-emdc-button-primary" @click="createDialogVisible = true">
                                <el-icon><Plus /></el-icon>
                                创建函数
                            </el-button>
                        </div>

                        <el-table :data="functions" class="common-table" stripe>
                            <el-table-column prop="name" label="函数名称" width="180" />
                            <el-table-column prop="image" label="镜像" />
                            <el-table-column prop="namespace" label="命名空间" width="120" />
                            <el-table-column prop="invocations" label="调用次数" width="120" :formatter="formatNumber" />
                            <el-table-column prop="replicas" label="副本数" width="100" />
                            <el-table-column prop="status" label="状态" width="100">
                                <template #default="scope">
                                    <el-tag :type="getStatusType(scope.row.status)">{{ getStatusText(scope.row.status) }}</el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="操作" width="200">
                                <template #default="scope">
                                    <div class="function-actions">
                                        <el-button class="-emdc-button-plain" size="small" @click="showDetails(scope.row)">
                                            详情
                                        </el-button>
                                        <el-button type="danger" size="small" @click="deleteFunction(scope.row)">
                                            删除
                                        </el-button>
                                    </div>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </el-tab-pane>

                <el-tab-pane label="监控指标" name="metrics">
                    <div class="content-panel">
                        <div class="section-header">
                            <h2 class="section-title">监控指标概览</h2>
                        </div>

                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-value">{{ totalInvocations }}</div>
                                <div class="metric-label">总调用次数</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">{{ activeFunctions }}</div>
                                <div class="metric-label">活跃函数数量</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">{{ successRate }}%</div>
                                <div class="metric-label">成功率</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">{{ avgResponseTime }}ms</div>
                                <div class="metric-label">平均响应时间</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="invocationChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <canvas id="resourceChart"></canvas>
                        </div>

                        <!-- 测试结果图表 -->
                        <div class="test-chart-container">
                            <div class="test-chart-title">CSV 测试数据与标准线对比</div>
                            <canvas id="testChart"></canvas>
                        </div>
                    </div>
                </el-tab-pane>

                <el-tab-pane label="性能测试" name="benchmark">
                    <div class="content-panel">
                        <div class="section-header">
                            <h2 class="section-title">性能基准测试</h2>
                        </div>

                        <el-form :model="benchmarkForm" inline class="benchmark-controls">
                            <el-form-item label="目标函数:">
                                <el-select v-model="benchmarkForm.targetFunction" class="common-select">
                                    <el-option label="hello-world" value="hello-world"></el-option>
                                    <el-option label="user-service" value="user-service"></el-option>
                                    <el-option label="data-processor" value="data-processor"></el-option>
                                </el-select>
                            </el-form-item>
                            
                            <el-form-item label="并发用户数:">
                                <el-select v-model="benchmarkForm.concurrentUsers" class="common-select">
                                    <el-option label="10" :value="10"></el-option>
                                    <el-option label="50" :value="50"></el-option>
                                    <el-option label="100" :value="100"></el-option>
                                    <el-option label="500" :value="500"></el-option>
                                </el-select>
                            </el-form-item>
                            
                            <el-form-item label="持续时间(秒):">
                                <el-input-number 
                                    v-model="benchmarkForm.duration" 
                                    class="common-input"
                                    :min="10" 
                                    :max="300" 
                                    :step="10">
                                </el-input-number>
                            </el-form-item>
                            
                            <el-form-item>
                                <el-button class="-emdc-button-primary" @click="startBenchmark" :loading="benchmarkLoading">
                                    <el-icon><CaretRight /></el-icon>
                                    开始测试
                                </el-button>
                            </el-form-item>
                        </el-form>

                        <div v-if="benchmarkResults" class="benchmark-results">
                            <h3>测试结果</h3>
                            <el-descriptions :column="2" border>
                                <el-descriptions-item label="总请求数">{{ benchmarkResults.totalRequests }}</el-descriptions-item>
                                <el-descriptions-item label="成功请求数">{{ benchmarkResults.successfulRequests }}</el-descriptions-item>
                                <el-descriptions-item label="失败请求数">{{ benchmarkResults.failedRequests }}</el-descriptions-item>
                                <el-descriptions-item label="平均响应时间">{{ benchmarkResults.avgResponseTime }}</el-descriptions-item>
                                <el-descriptions-item label="每秒请求数">{{ benchmarkResults.requestsPerSecond }}</el-descriptions-item>
                                <el-descriptions-item label="95% 百分位">{{ benchmarkResults.percentile95 }}</el-descriptions-item>
                            </el-descriptions>
                        </div>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>

        <!-- 创建函数对话框 -->
        <el-dialog 
            v-model="createDialogVisible" 
            title="创建新函数"
            width="500px">
            <el-form :model="createForm" label-width="120px">
                <el-form-item label="函数名称:">
                    <el-input v-model="createForm.name" class="common-input" placeholder="my-function"></el-input>
                </el-form-item>
                
                <el-form-item label="镜像:">
                    <el-input v-model="createForm.image" class="common-input" placeholder="functions/alpine:latest"></el-input>
                </el-form-item>
                
                <el-form-item label="环境变量:">
                    <el-input 
                        v-model="createForm.envVars" 
                        type="textarea" 
                        class="common-textarea"
                        :rows="4"
                        placeholder="KEY1=value1&#10;KEY2=value2">
                    </el-input>
                </el-form-item>
                
                <el-form-item label="标签:">
                    <el-input 
                        v-model="createForm.labels" 
                        type="textarea"
                        class="common-textarea"
                        :rows="4"
                        placeholder="com.openfaas.scale.min=1&#10;com.openfaas.scale.max=5">
                    </el-input>
                </el-form-item>
            </el-form>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="createDialogVisible = false">取消</el-button>
                    <el-button class="-emdc-button-primary" @click="createFunction">创建函数</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 函数详情对话框 -->
        <el-dialog 
            v-model="detailsDialogVisible" 
            title="函数详情"
            width="600px">
            <div v-if="selectedFunction">
                <el-descriptions title="" :column="1" border>
                    <el-descriptions-item label="名称">{{ selectedFunction.name }}</el-descriptions-item>
                    <el-descriptions-item label="镜像">{{ selectedFunction.image }}</el-descriptions-item>
                    <el-descriptions-item label="状态">
                        <el-tag :type="getStatusType(selectedFunction.status)">{{ getStatusText(selectedFunction.status) }}</el-tag>
                    </el-descriptions-item>
                    <el-descriptions-item label="命名空间">{{ selectedFunction.namespace }}</el-descriptions-item>
                    <el-descriptions-item label="调用次数">{{ formatNumber({}, {}, selectedFunction.invocations) }}</el-descriptions-item>
                    <el-descriptions-item label="副本数">{{ selectedFunction.replicas }}</el-descriptions-item>
                </el-descriptions>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">环境变量:</h4>
                <el-tag v-for="(value, key) in selectedFunction.envVars" :key="key" style="margin: 2px;">
                    {{ key }}: {{ value }}
                </el-tag>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">标签:</h4>
                <el-tag v-for="(value, key) in selectedFunction.labels" :key="key" style="margin: 2px;" type="info">
                    {{ key }}: {{ value }}
                </el-tag>
            </div>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    activeTab: 'namespace',
                    selectedNamespace: 'default',
                    createDialogVisible: false,
                    detailsDialogVisible: false,
                    benchmarkLoading: false,
                    selectedFunction: null,
                    benchmarkResults: null,
                    
                    // 创建表单
                    createForm: {
                        name: '',
                        image: '',
                        envVars: '',
                        labels: ''
                    },
                    
                    // 基准测试表单
                    benchmarkForm: {
                        targetFunction: 'hello-world',
                        concurrentUsers: 50,
                        duration: 60
                    },
                    
                    // Namespace 数据
                    namespaces: [
                        {
                            name: "default",
                            status: "Active",
                            statusText: "活跃",
                            functions: 12,
                            cpuUsage: "45%",
                            memory: "2.1GB / 4GB"
                        },
                        {
                            name: "production", 
                            status: "Active",
                            statusText: "活跃",
                            functions: 8,
                            cpuUsage: "23%",
                            memory: "1.5GB / 8GB"
                        },
                        {
                            name: "development",
                            status: "Pending",
                            statusText: "等待中", 
                            functions: 3,
                            cpuUsage: "12%",
                            memory: "512MB / 2GB"
                        }
                    ],
                    
                    // Functions 数据
                    functions: [
                        {
                            name: "hello-world",
                            image: "functions/alpine:latest",
                            status: "running",
                            invocations: 1423,
                            replicas: "1/1",
                            namespace: "default",
                            labels: {"com.openfaas.scale.min": "1", "com.openfaas.scale.max": "5"},
                            envVars: {"PATH": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"}
                        },
                        {
                            name: "user-service",
                            image: "functions/node12:latest", 
                            status: "running",
                            invocations: 856,
                            replicas: "2/2",
                            namespace: "production",
                            labels: {"com.openfaas.scale.min": "2", "com.openfaas.scale.max": "10"},
                            envVars: {"NODE_ENV": "production", "PORT": "8080"}
                        },
                        {
                            name: "data-processor",
                            image: "functions/python3:latest",
                            status: "stopped", 
                            invocations: 234,
                            replicas: "0/1",
                            namespace: "development",
                            labels: {"com.openfaas.scale.min": "0", "com.openfaas.scale.max": "3"},
                            envVars: {"PYTHON_ENV": "development"}
                        }
                    ]
                }
            },
            
            computed: {
                totalInvocations() {
                    return this.functions.reduce((sum, func) => sum + func.invocations, 0);
                },
                activeFunctions() {
                    return this.functions.filter(func => func.status === 'running').length;
                },
                successRate() {
                    return 98.5;
                },
                avgResponseTime() {
                    return 142;
                }
            },
            
            mounted() {
                this.$nextTick(() => {
                    this.initCharts();
                });
            },
            
            methods: {
                getStatusType(status) {
                    switch (status) {
                        case 'running':
                        case 'Active':
                            return 'success';
                        case 'stopped':
                            return 'danger';
                        case 'pending':
                        case 'Pending':
                            return 'warning';
                        default:
                            return 'info';
                    }
                },

                getStatusText(status) {
                    switch (status) {
                        case 'running':
                            return '运行中';
                        case 'stopped':
                            return '已停止';
                        case 'pending':
                            return '等待中';
                        case 'Active':
                            return '活跃';
                        case 'Pending':
                            return '等待中';
                        default:
                            return status;
                    }
                },
                
                formatNumber(row, column, cellValue) {
                    return cellValue.toLocaleString();
                },
                
                showDetails(func) {
                    this.selectedFunction = func;
                    this.detailsDialogVisible = true;
                },
                
                deleteFunction(func) {
                    ElMessageBox.confirm(
                        `确定要删除函数 "${func.name}" 吗？`,
                        'Warning',
                        {
                            confirmButtonText: 'OK',
                            cancelButtonText: 'Cancel',
                            type: 'warning',
                        }
                    ).then(() => {
                        const index = this.functions.findIndex(f => f.name === func.name);
                        if (index > -1) {
                            this.functions.splice(index, 1);
                            ElMessage.success(`Function "${func.name}" deleted successfully!`);
                        }
                    }).catch(() => {
                        ElMessage.info('Delete canceled');
                    });
                },
                
                createFunction() {
                    if (!this.createForm.name || !this.createForm.image) {
                        ElMessage.error('请填写函数名和镜像');
                        return;
                    }
                    
                    // 解析环境变量和标签
                    const envVars = {};
                    const labels = {};
                    
                    if (this.createForm.envVars) {
                        this.createForm.envVars.split('\n').forEach(line => {
                            const [key, value] = line.split('=');
                            if (key && value) {
                                envVars[key.trim()] = value.trim();
                            }
                        });
                    }
                    
                    if (this.createForm.labels) {
                        this.createForm.labels.split('\n').forEach(line => {
                            const [key, value] = line.split('=');
                            if (key && value) {
                                labels[key.trim()] = value.trim();
                            }
                        });
                    }
                    
                    // 添加新函数
                    const newFunction = {
                        name: this.createForm.name,
                        image: this.createForm.image,
                        status: "pending",
                        invocations: 0,
                        replicas: "0/1",
                        namespace: this.selectedNamespace,
                        labels: labels,
                        envVars: envVars
                    };
                    
                    this.functions.push(newFunction);
                    this.createDialogVisible = false;
                    
                    // 重置表单
                    this.createForm = {
                        name: '',
                        image: '',
                        envVars: '',
                        labels: ''
                    };
                    
                    ElMessage.success(`Function "${newFunction.name}" created successfully!`);
                },
                
                async startBenchmark() {
                    this.benchmarkLoading = true;
                    
                    try {
                        // 模拟基准测试
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        const totalRequests = this.benchmarkForm.concurrentUsers * this.benchmarkForm.duration * (Math.random() * 2 + 1);
                        const successRate = 0.95 + Math.random() * 0.04;
                        const successfulRequests = Math.floor(totalRequests * successRate);
                        const failedRequests = totalRequests - successfulRequests;
                        const avgResponseTime = Math.floor(50 + Math.random() * 200);
                        const requestsPerSecond = Math.floor(totalRequests / this.benchmarkForm.duration);
                        const percentile95 = Math.floor(avgResponseTime * 1.8);
                        
                        this.benchmarkResults = {
                            totalRequests: totalRequests.toLocaleString(),
                            successfulRequests: successfulRequests.toLocaleString(),
                            failedRequests: failedRequests.toLocaleString(),
                            avgResponseTime: avgResponseTime + 'ms',
                            requestsPerSecond: requestsPerSecond.toLocaleString(),
                            percentile95: percentile95 + 'ms'
                        };
                        
                        ElMessage.success('Benchmark completed successfully!');
                    } catch (error) {
                        ElMessage.error('Benchmark failed: ' + error.message);
                    } finally {
                        this.benchmarkLoading = false;
                    }
                },
                
                initCharts() {
                    // 初始化调用趋势图表
                    const invocationCtx = document.getElementById('invocationChart');
                    if (invocationCtx) {
                        new Chart(invocationCtx, {
                            type: 'line',
                            data: {
                                labels: ['1h', '2h', '3h', '4h', '5h', '6h', '7h', '8h', '9h', '10h', '11h', '12h'],
                                datasets: [{
                                    label: 'Invocations',
                                    data: [120, 135, 180, 210, 190, 175, 220, 240, 180, 165, 195, 220],
                                    borderColor: '#0C8357',
                                    backgroundColor: 'rgba(12, 131, 87, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Function Invocation Trends'
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                    
                    // 初始化资源使用图表
                    const resourceCtx = document.getElementById('resourceChart');
                    if (resourceCtx) {
                        new Chart(resourceCtx, {
                            type: 'bar',
                            data: {
                                labels: ['CPU Usage', 'Memory Usage', 'Network I/O', 'Disk I/O'],
                                datasets: [{
                                    label: 'Usage %',
                                    data: [45, 62, 28, 35],
                                    backgroundColor: [
                                        'rgba(12, 131, 87, 0.8)',
                                        'rgba(118, 75, 162, 0.8)', 
                                        'rgba(247, 181, 0, 0.8)',
                                        'rgba(224, 32, 32, 0.8)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Resource Usage Overview'
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100
                                    }
                                }
                            }
                        });
                    }
                    
                    // 初始化测试数据图表（模拟CSV数据）
                    const testCtx = document.getElementById('testChart');
                    if (testCtx) {
                        // 生成模拟测试数据
                        const testData = this.generateTestData();
                        
                        new Chart(testCtx, {
                            type: 'line',
                            data: {
                                labels: testData.labels,
                                datasets: [
                                    {
                                        label: 'TPS',
                                        data: testData.values,
                                        borderColor: '#1f77b4',
                                        backgroundColor: 'rgba(31, 119, 180, 0.1)',
                                        borderWidth: 2,
                                        fill: false,
                                        tension: 0.1
                                    },
                                    {
                                        label: 'Upper Standard (80000)',
                                        data: new Array(testData.labels.length).fill(80000),
                                        borderColor: '#ff0000',
                                        backgroundColor: 'transparent',
                                        borderWidth: 2,
                                        borderDash: [10, 5],
                                        fill: false,
                                        pointRadius: 0
                                    },
                                    {
                                        label: 'Lower Standard (70000)',
                                        data: new Array(testData.labels.length).fill(70000),
                                        borderColor: '#ff0000',
                                        backgroundColor: 'transparent',
                                        borderWidth: 2,
                                        borderDash: [10, 5],
                                        fill: false,
                                        pointRadius: 0
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: false
                                    },
                                    legend: {
                                        display: true,
                                        position: 'top'
                                    }
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Number of Experiments'
                                        }
                                    },
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'TPS'
                                        },
                                        min: 30000,
                                        max: 105000
                                    }
                                },
                                elements: {
                                    point: {
                                        radius: function(context) {
                                            const value = context.raw;
                                            // 标记异常值
                                            if (value < 70000 || value > 80000) {
                                                return 6;
                                            }
                                            return 2;
                                        },
                                        backgroundColor: function(context) {
                                            const value = context.raw;
                                            // 异常值用红色标记
                                            if (value < 70000 || value > 80000) {
                                                return '#ff0000';
                                            }
                                            return context.dataset.borderColor;
                                        }
                                    }
                                }
                            }
                        });
                    }
                },
                
                generateTestData() {
                    // 生成类似图片中的测试数据
                    const labels = [];
                    const values = [];
                    
                    for (let i = 0; i <= 100; i++) {
                        labels.push(i.toString());
                        
                        // 基础值在75000-85000之间波动
                        let baseValue = 75000 + Math.random() * 10000;
                        
                        // 添加一些尖峰
                        if (Math.random() < 0.1) {
                            baseValue += Math.random() * 20000;
                        }
                        
                        // 添加一些异常低值
                        if (Math.random() < 0.08) {
                            baseValue = 30000 + Math.random() * 40000;
                        }
                        
                        values.push(Math.floor(baseValue));
                    }
                    
                    return { labels, values };
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>